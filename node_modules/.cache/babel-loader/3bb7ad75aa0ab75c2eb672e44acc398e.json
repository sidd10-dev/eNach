{"ast":null,"code":"'use strict'; // Load Date class extensions\n\nvar CronDate = require('./date'); // Get Number.isNaN or the polyfill\n\n\nvar safeIsNaN = require('is-nan');\n\nvar stringifyField = require('./field_stringify');\n/**\n * Cron iteration loop safety limit\n */\n\n\nvar LOOP_LIMIT = 10000;\n/**\n * Construct a new expression parser\n *\n * Options:\n *   currentDate: iterator start date\n *   endDate: iterator end date\n *\n * @constructor\n * @private\n * @param {Object} fields  Expression fields parsed values\n * @param {Object} options Parser options\n */\n\nfunction CronExpression(fields, options) {\n  this._options = options;\n  this._utc = options.utc || false;\n  this._tz = this._utc ? 'UTC' : options.tz;\n  this._currentDate = new CronDate(options.currentDate, this._tz);\n  this._startDate = options.startDate ? new CronDate(options.startDate, this._tz) : null;\n  this._endDate = options.endDate ? new CronDate(options.endDate, this._tz) : null;\n  this._isIterator = options.iterator || false;\n  this._hasIterated = false;\n  this._nthDayOfWeek = options.nthDayOfWeek || 0;\n  this.fields = CronExpression._freezeFields(fields);\n}\n/**\n * Field mappings\n * @type {Array}\n */\n\n\nCronExpression.map = ['second', 'minute', 'hour', 'dayOfMonth', 'month', 'dayOfWeek'];\n/**\n * Prefined intervals\n * @type {Object}\n */\n\nCronExpression.predefined = {\n  '@yearly': '0 0 1 1 *',\n  '@monthly': '0 0 1 * *',\n  '@weekly': '0 0 * * 0',\n  '@daily': '0 0 * * *',\n  '@hourly': '0 * * * *'\n};\n/**\n * Fields constraints\n * @type {Array}\n */\n\nCronExpression.constraints = [{\n  min: 0,\n  max: 59,\n  chars: []\n}, // Second\n{\n  min: 0,\n  max: 59,\n  chars: []\n}, // Minute\n{\n  min: 0,\n  max: 23,\n  chars: []\n}, // Hour\n{\n  min: 1,\n  max: 31,\n  chars: ['L']\n}, // Day of month\n{\n  min: 1,\n  max: 12,\n  chars: []\n}, // Month\n{\n  min: 0,\n  max: 7,\n  chars: []\n} // Day of week\n];\n/**\n * Days in month\n * @type {number[]}\n */\n\nCronExpression.daysInMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];\n/**\n * Field aliases\n * @type {Object}\n */\n\nCronExpression.aliases = {\n  month: {\n    jan: 1,\n    feb: 2,\n    mar: 3,\n    apr: 4,\n    may: 5,\n    jun: 6,\n    jul: 7,\n    aug: 8,\n    sep: 9,\n    oct: 10,\n    nov: 11,\n    dec: 12\n  },\n  dayOfWeek: {\n    sun: 0,\n    mon: 1,\n    tue: 2,\n    wed: 3,\n    thu: 4,\n    fri: 5,\n    sat: 6\n  }\n};\n/**\n * Field defaults\n * @type {Array}\n */\n\nCronExpression.parseDefaults = ['0', '*', '*', '*', '*', '*'];\nCronExpression.standardValidCharacters = /^[\\d|/|*|\\-|,]+$/;\nCronExpression.dayOfWeekValidCharacters = /^[\\d|/|*|\\-|,|\\?]+$/;\nCronExpression.dayOfMonthValidCharacters = /^[\\d|L|/|*|\\-|,|\\?]+$/;\nCronExpression.validCharacters = {\n  second: CronExpression.standardValidCharacters,\n  minute: CronExpression.standardValidCharacters,\n  hour: CronExpression.standardValidCharacters,\n  dayOfMonth: CronExpression.dayOfMonthValidCharacters,\n  month: CronExpression.standardValidCharacters,\n  dayOfWeek: CronExpression.dayOfWeekValidCharacters\n};\n/**\n * Parse input interval\n *\n * @param {String} field Field symbolic name\n * @param {String} value Field value\n * @param {Array} constraints Range upper and lower constraints\n * @return {Array} Sequence of sorted values\n * @private\n */\n\nCronExpression._parseField = function _parseField(field, value, constraints) {\n  // Replace aliases\n  switch (field) {\n    case 'month':\n    case 'dayOfWeek':\n      var aliases = CronExpression.aliases[field];\n      value = value.replace(/[a-z]{1,3}/gi, function (match) {\n        match = match.toLowerCase();\n\n        if (typeof aliases[match] !== 'undefined') {\n          return aliases[match];\n        } else {\n          throw new Error('Validation error, cannot resolve alias \"' + match + '\"');\n        }\n      });\n      break;\n  } // Check for valid characters.\n\n\n  if (!CronExpression.validCharacters[field].test(value)) {\n    throw new Error('Invalid characters, got value: ' + value);\n  } // Replace '*' and '?'\n\n\n  if (value.indexOf('*') !== -1) {\n    value = value.replace(/\\*/g, constraints.min + '-' + constraints.max);\n  } else if (value.indexOf('?') !== -1) {\n    value = value.replace(/\\?/g, constraints.min + '-' + constraints.max);\n  } //\n  // Inline parsing functions\n  //\n  // Parser path:\n  //  - parseSequence\n  //    - parseRepeat\n  //      - parseRange\n\n  /**\n   * Parse sequence\n   *\n   * @param {String} val\n   * @return {Array}\n   * @private\n   */\n\n\n  function parseSequence(val) {\n    var stack = [];\n\n    function handleResult(result) {\n      if (result instanceof Array) {\n        // Make sequence linear\n        for (var i = 0, c = result.length; i < c; i++) {\n          var value = result[i];\n\n          if (typeof value === 'string' && constraints.chars.indexOf(value) > -1) {\n            stack.push(value);\n            continue;\n          } // Check constraints\n\n\n          if (typeof value !== 'number' || safeIsNaN(value) || value < constraints.min || value > constraints.max) {\n            throw new Error('Constraint error, got value ' + value + ' expected range ' + constraints.min + '-' + constraints.max);\n          }\n\n          stack.push(value);\n        }\n      } else {\n        // Scalar value\n        if (typeof result === 'string' && constraints.chars.indexOf(result) > -1) {\n          stack.push(result);\n          return;\n        }\n\n        var numResult = +result; // Check constraints\n\n        if (safeIsNaN(numResult) || numResult < constraints.min || numResult > constraints.max) {\n          throw new Error('Constraint error, got value ' + result + ' expected range ' + constraints.min + '-' + constraints.max);\n        }\n\n        if (field === 'dayOfWeek') {\n          numResult = numResult % 7;\n        }\n\n        stack.push(numResult);\n      }\n    }\n\n    var atoms = val.split(',');\n\n    if (!atoms.every(function (atom) {\n      return atom.length > 0;\n    })) {\n      throw new Error('Invalid list value format');\n    }\n\n    if (atoms.length > 1) {\n      for (var i = 0, c = atoms.length; i < c; i++) {\n        handleResult(parseRepeat(atoms[i]));\n      }\n    } else {\n      handleResult(parseRepeat(val));\n    }\n\n    stack.sort(CronExpression._sortCompareFn);\n    return stack;\n  }\n  /**\n   * Parse repetition interval\n   *\n   * @param {String} val\n   * @return {Array}\n   */\n\n\n  function parseRepeat(val) {\n    var repeatInterval = 1;\n    var atoms = val.split('/');\n\n    if (atoms.length > 1) {\n      if (atoms[0] == +atoms[0]) {\n        atoms = [atoms[0] + '-' + constraints.max, atoms[1]];\n      }\n\n      return parseRange(atoms[0], atoms[atoms.length - 1]);\n    }\n\n    return parseRange(val, repeatInterval);\n  }\n  /**\n   * Parse range\n   *\n   * @param {String} val\n   * @param {Number} repeatInterval Repetition interval\n   * @return {Array}\n   * @private\n   */\n\n\n  function parseRange(val, repeatInterval) {\n    var stack = [];\n    var atoms = val.split('-');\n\n    if (atoms.length > 1) {\n      // Invalid range, return value\n      if (atoms.length < 2) {\n        return +val;\n      }\n\n      if (!atoms[0].length) {\n        if (!atoms[1].length) {\n          throw new Error('Invalid range: ' + val);\n        }\n\n        return +val;\n      } // Validate range\n\n\n      var min = +atoms[0];\n      var max = +atoms[1];\n\n      if (safeIsNaN(min) || safeIsNaN(max) || min < constraints.min || max > constraints.max) {\n        throw new Error('Constraint error, got range ' + min + '-' + max + ' expected range ' + constraints.min + '-' + constraints.max);\n      } else if (min >= max) {\n        throw new Error('Invalid range: ' + val);\n      } // Create range\n\n\n      var repeatIndex = +repeatInterval;\n\n      if (safeIsNaN(repeatIndex) || repeatIndex <= 0) {\n        throw new Error('Constraint error, cannot repeat at every ' + repeatIndex + ' time.');\n      }\n\n      for (var index = min, count = max; index <= count; index++) {\n        if (repeatIndex > 0 && repeatIndex % repeatInterval === 0) {\n          repeatIndex = 1;\n          stack.push(index);\n        } else {\n          repeatIndex++;\n        }\n      }\n\n      return stack;\n    }\n\n    return safeIsNaN(+val) ? val : +val;\n  }\n\n  return parseSequence(value);\n};\n\nCronExpression._sortCompareFn = function (a, b) {\n  var aIsNumber = typeof a === 'number';\n  var bIsNumber = typeof b === 'number';\n\n  if (aIsNumber && bIsNumber) {\n    return a - b;\n  }\n\n  if (!aIsNumber && bIsNumber) {\n    return 1;\n  }\n\n  if (aIsNumber && !bIsNumber) {\n    return -1;\n  }\n\n  return a.localeCompare(b);\n};\n\nCronExpression._handleMaxDaysInMonth = function (mappedFields) {\n  // Filter out any day of month value that is larger than given month expects\n  if (mappedFields.month.length === 1) {\n    var daysInMonth = CronExpression.daysInMonth[mappedFields.month[0] - 1];\n\n    if (mappedFields.dayOfMonth[0] > daysInMonth) {\n      throw new Error('Invalid explicit day of month definition');\n    }\n\n    return mappedFields.dayOfMonth.filter(function (dayOfMonth) {\n      return dayOfMonth === 'L' ? true : dayOfMonth <= daysInMonth;\n    }).sort(CronExpression._sortCompareFn);\n  }\n};\n\nCronExpression._freezeFields = function (fields) {\n  for (var i = 0, c = CronExpression.map.length; i < c; ++i) {\n    var field = CronExpression.map[i]; // Field name\n\n    var value = fields[field];\n    fields[field] = Object.freeze(value);\n  }\n\n  return Object.freeze(fields);\n};\n\nCronExpression.prototype._applyTimezoneShift = function (currentDate, dateMathVerb, method) {\n  if (method === 'Month' || method === 'Day') {\n    var prevTime = currentDate.getTime();\n    currentDate[dateMathVerb + method]();\n    var currTime = currentDate.getTime();\n\n    if (prevTime === currTime) {\n      // Jumped into a not existent date due to a DST transition\n      if (currentDate.getMinutes() === 0 && currentDate.getSeconds() === 0) {\n        currentDate.addHour();\n      } else if (currentDate.getMinutes() === 59 && currentDate.getSeconds() === 59) {\n        currentDate.subtractHour();\n      }\n    }\n  } else {\n    var previousHour = currentDate.getHours();\n    currentDate[dateMathVerb + method]();\n    var currentHour = currentDate.getHours();\n    var diff = currentHour - previousHour;\n\n    if (diff === 2) {\n      // Starting DST\n      if (this.fields.hour.length !== 24) {\n        // Hour is specified\n        this._dstStart = currentHour;\n      }\n    } else if (diff === 0 && currentDate.getMinutes() === 0 && currentDate.getSeconds() === 0) {\n      // Ending DST\n      if (this.fields.hour.length !== 24) {\n        // Hour is specified\n        this._dstEnd = currentHour;\n      }\n    }\n  }\n};\n/**\n * Find next or previous matching schedule date\n *\n * @return {CronDate}\n * @private\n */\n\n\nCronExpression.prototype._findSchedule = function _findSchedule(reverse) {\n  /**\n   * Match field value\n   *\n   * @param {String} value\n   * @param {Array} sequence\n   * @return {Boolean}\n   * @private\n   */\n  function matchSchedule(value, sequence) {\n    for (var i = 0, c = sequence.length; i < c; i++) {\n      if (sequence[i] >= value) {\n        return sequence[i] === value;\n      }\n    }\n\n    return sequence[0] === value;\n  }\n  /**\n   * Helps determine if the provided date is the correct nth occurence of the\n   * desired day of week.\n   *\n   * @param {CronDate} date\n   * @param {Number} nthDayOfWeek\n   * @return {Boolean}\n   * @private\n   */\n\n\n  function isNthDayMatch(date, nthDayOfWeek) {\n    if (nthDayOfWeek < 6) {\n      if (date.getDate() < 8 && nthDayOfWeek === 1 // First occurence has to happen in first 7 days of the month\n      ) {\n        return true;\n      }\n\n      var offset = date.getDate() % 7 ? 1 : 0; // Math is off by 1 when dayOfWeek isn't divisible by 7\n\n      var adjustedDate = date.getDate() - date.getDate() % 7; // find the first occurance\n\n      var occurrence = Math.floor(adjustedDate / 7) + offset;\n      return occurrence === nthDayOfWeek;\n    }\n\n    return false;\n  }\n  /**\n   * Helper function that checks if 'L' is in the array\n   *\n   * @param {Array} dayOfMonth\n   */\n\n\n  function isLInDayOfMonth(dayOfMonth) {\n    return dayOfMonth.length > 0 && dayOfMonth.indexOf('L') >= 0;\n  } // Whether to use backwards directionality when searching\n\n\n  reverse = reverse || false;\n  var dateMathVerb = reverse ? 'subtract' : 'add';\n  var currentDate = new CronDate(this._currentDate, this._tz);\n  var startDate = this._startDate;\n  var endDate = this._endDate; // Find matching schedule\n\n  var startTimestamp = currentDate.getTime();\n  var stepCount = 0;\n\n  while (stepCount < LOOP_LIMIT) {\n    stepCount++; // Validate timespan\n\n    if (reverse) {\n      if (startDate && currentDate.getTime() - startDate.getTime() < 0) {\n        throw new Error('Out of the timespan range');\n      }\n    } else {\n      if (endDate && endDate.getTime() - currentDate.getTime() < 0) {\n        throw new Error('Out of the timespan range');\n      }\n    } // Day of month and week matching:\n    //\n    // \"The day of a command's execution can be specified by two fields --\n    // day of month, and day of week.  If  both\t fields\t are  restricted  (ie,\n    // aren't  *),  the command will be run when either field matches the cur-\n    // rent time.  For example, \"30 4 1,15 * 5\" would cause a command to be\n    // run at 4:30 am on the  1st and 15th of each month, plus every Friday.\"\n    //\n    // http://unixhelp.ed.ac.uk/CGI/man-cgi?crontab+5\n    //\n\n\n    var dayOfMonthMatch = matchSchedule(currentDate.getDate(), this.fields.dayOfMonth);\n\n    if (isLInDayOfMonth(this.fields.dayOfMonth)) {\n      dayOfMonthMatch = dayOfMonthMatch || currentDate.isLastDayOfMonth();\n    }\n\n    var dayOfWeekMatch = matchSchedule(currentDate.getDay(), this.fields.dayOfWeek);\n    var isDayOfMonthWildcardMatch = this.fields.dayOfMonth.length >= CronExpression.daysInMonth[currentDate.getMonth()];\n    var isDayOfWeekWildcardMatch = this.fields.dayOfWeek.length === CronExpression.constraints[5].max - CronExpression.constraints[5].min + 1;\n    var currentHour = currentDate.getHours(); // Add or subtract day if select day not match with month (according to calendar)\n\n    if (!dayOfMonthMatch && !dayOfWeekMatch) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n\n      continue;\n    } // Add or subtract day if not day of month is set (and no match) and day of week is wildcard\n\n\n    if (!isDayOfMonthWildcardMatch && isDayOfWeekWildcardMatch && !dayOfMonthMatch) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n\n      continue;\n    } // Add or subtract day if not day of week is set (and no match) and day of month is wildcard\n\n\n    if (isDayOfMonthWildcardMatch && !isDayOfWeekWildcardMatch && !dayOfWeekMatch) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n\n      continue;\n    } // Add or subtract day if day of week & nthDayOfWeek are set (and no match)\n\n\n    if (this._nthDayOfWeek > 0 && !isNthDayMatch(currentDate, this._nthDayOfWeek)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n\n      continue;\n    } // Match month\n\n\n    if (!matchSchedule(currentDate.getMonth() + 1, this.fields.month)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Month');\n\n      continue;\n    } // Match hour\n\n\n    if (!matchSchedule(currentHour, this.fields.hour)) {\n      if (this._dstStart !== currentHour) {\n        this._dstStart = null;\n\n        this._applyTimezoneShift(currentDate, dateMathVerb, 'Hour');\n\n        continue;\n      } else if (!matchSchedule(currentHour - 1, this.fields.hour)) {\n        currentDate[dateMathVerb + 'Hour']();\n        continue;\n      }\n    } else if (this._dstEnd === currentHour) {\n      if (!reverse) {\n        this._dstEnd = null;\n\n        this._applyTimezoneShift(currentDate, 'add', 'Hour');\n\n        continue;\n      }\n    } // Match minute\n\n\n    if (!matchSchedule(currentDate.getMinutes(), this.fields.minute)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Minute');\n\n      continue;\n    } // Match second\n\n\n    if (!matchSchedule(currentDate.getSeconds(), this.fields.second)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Second');\n\n      continue;\n    } // Increase a second in case in the first iteration the currentDate was not\n    // modified\n\n\n    if (startTimestamp === currentDate.getTime()) {\n      if (dateMathVerb === 'add' || currentDate.getMilliseconds() === 0) {\n        this._applyTimezoneShift(currentDate, dateMathVerb, 'Second');\n      } else {\n        currentDate.setMilliseconds(0);\n      }\n\n      continue;\n    }\n\n    break;\n  }\n\n  if (stepCount >= LOOP_LIMIT) {\n    throw new Error('Invalid expression, loop limit exceeded');\n  }\n\n  this._currentDate = new CronDate(currentDate, this._tz);\n  this._hasIterated = true;\n  return currentDate;\n};\n/**\n * Find next suitable date\n *\n * @public\n * @return {CronDate|Object}\n */\n\n\nCronExpression.prototype.next = function next() {\n  var schedule = this._findSchedule(); // Try to return ES6 compatible iterator\n\n\n  if (this._isIterator) {\n    return {\n      value: schedule,\n      done: !this.hasNext()\n    };\n  }\n\n  return schedule;\n};\n/**\n * Find previous suitable date\n *\n * @public\n * @return {CronDate|Object}\n */\n\n\nCronExpression.prototype.prev = function prev() {\n  var schedule = this._findSchedule(true); // Try to return ES6 compatible iterator\n\n\n  if (this._isIterator) {\n    return {\n      value: schedule,\n      done: !this.hasPrev()\n    };\n  }\n\n  return schedule;\n};\n/**\n * Check if next suitable date exists\n *\n * @public\n * @return {Boolean}\n */\n\n\nCronExpression.prototype.hasNext = function () {\n  var current = this._currentDate;\n  var hasIterated = this._hasIterated;\n\n  try {\n    this._findSchedule();\n\n    return true;\n  } catch (err) {\n    return false;\n  } finally {\n    this._currentDate = current;\n    this._hasIterated = hasIterated;\n  }\n};\n/**\n * Check if previous suitable date exists\n *\n * @public\n * @return {Boolean}\n */\n\n\nCronExpression.prototype.hasPrev = function () {\n  var current = this._currentDate;\n  var hasIterated = this._hasIterated;\n\n  try {\n    this._findSchedule(true);\n\n    return true;\n  } catch (err) {\n    return false;\n  } finally {\n    this._currentDate = current;\n    this._hasIterated = hasIterated;\n  }\n};\n/**\n * Iterate over expression iterator\n *\n * @public\n * @param {Number} steps Numbers of steps to iterate\n * @param {Function} callback Optional callback\n * @return {Array} Array of the iterated results\n */\n\n\nCronExpression.prototype.iterate = function iterate(steps, callback) {\n  var dates = [];\n\n  if (steps >= 0) {\n    for (var i = 0, c = steps; i < c; i++) {\n      try {\n        var item = this.next();\n        dates.push(item); // Fire the callback\n\n        if (callback) {\n          callback(item, i);\n        }\n      } catch (err) {\n        break;\n      }\n    }\n  } else {\n    for (var i = 0, c = steps; i > c; i--) {\n      try {\n        var item = this.prev();\n        dates.push(item); // Fire the callback\n\n        if (callback) {\n          callback(item, i);\n        }\n      } catch (err) {\n        break;\n      }\n    }\n  }\n\n  return dates;\n};\n/**\n * Reset expression iterator state\n *\n * @public\n */\n\n\nCronExpression.prototype.reset = function reset(newDate) {\n  this._currentDate = new CronDate(newDate || this._options.currentDate);\n};\n/**\n * Stringify the expression\n *\n * @public\n * @param {Boolean} [includeSeconds] Should stringify seconds\n * @return {String}\n */\n\n\nCronExpression.prototype.stringify = function stringify(includeSeconds) {\n  var resultArr = [];\n\n  for (var i = includeSeconds ? 0 : 1, c = CronExpression.map.length; i < c; ++i) {\n    var field = CronExpression.map[i];\n    var value = this.fields[field];\n    var constraint = CronExpression.constraints[i];\n    resultArr.push(stringifyField(value, constraint.min, constraint.max));\n  }\n\n  return resultArr.join(' ');\n};\n/**\n * Parse input expression (async)\n *\n * @public\n * @param {String} expression Input expression\n * @param {Object} [options] Parsing options\n */\n\n\nCronExpression.parse = function parse(expression, options) {\n  var self = this;\n\n  if (typeof options === 'function') {\n    options = {};\n  }\n\n  function parse(expression, options) {\n    if (!options) {\n      options = {};\n    }\n\n    if (typeof options.currentDate === 'undefined') {\n      options.currentDate = new CronDate(undefined, self._tz);\n    } // Is input expression predefined?\n\n\n    if (CronExpression.predefined[expression]) {\n      expression = CronExpression.predefined[expression];\n    } // Split fields\n\n\n    var fields = [];\n    var atoms = (expression + '').trim().split(/\\s+/);\n\n    if (atoms.length > 6) {\n      throw new Error('Invalid cron expression');\n    } // Resolve fields\n\n\n    var start = CronExpression.map.length - atoms.length;\n\n    for (var i = 0, c = CronExpression.map.length; i < c; ++i) {\n      var field = CronExpression.map[i]; // Field name\n\n      var value = atoms[atoms.length > c ? i : i - start]; // Field value\n\n      if (i < start || !value) {\n        // Use default value\n        fields.push(CronExpression._parseField(field, CronExpression.parseDefaults[i], CronExpression.constraints[i]));\n      } else {\n        var val = field === 'dayOfWeek' ? parseNthDay(value) : value;\n        fields.push(CronExpression._parseField(field, val, CronExpression.constraints[i]));\n      }\n    }\n\n    var mappedFields = {};\n\n    for (var i = 0, c = CronExpression.map.length; i < c; i++) {\n      var key = CronExpression.map[i];\n      mappedFields[key] = fields[i];\n    }\n\n    var dayOfMonth = CronExpression._handleMaxDaysInMonth(mappedFields);\n\n    mappedFields.dayOfMonth = dayOfMonth || mappedFields.dayOfMonth;\n    return new CronExpression(mappedFields, options);\n    /**\n     * Parses out the # special character for the dayOfWeek field & adds it to options.\n     *\n     * @param {String} val\n     * @return {String}\n     * @private\n     */\n\n    function parseNthDay(val) {\n      var atoms = val.split('#');\n\n      if (atoms.length > 1) {\n        var nthValue = +atoms[atoms.length - 1];\n\n        if (/,/.test(val)) {\n          throw new Error('Constraint error, invalid dayOfWeek `#` and `,` ' + 'special characters are incompatible');\n        }\n\n        if (/\\//.test(val)) {\n          throw new Error('Constraint error, invalid dayOfWeek `#` and `/` ' + 'special characters are incompatible');\n        }\n\n        if (/-/.test(val)) {\n          throw new Error('Constraint error, invalid dayOfWeek `#` and `-` ' + 'special characters are incompatible');\n        }\n\n        if (atoms.length > 2 || safeIsNaN(nthValue) || nthValue < 1 || nthValue > 5) {\n          throw new Error('Constraint error, invalid dayOfWeek occurrence number (#)');\n        }\n\n        options.nthDayOfWeek = nthValue;\n        return atoms[0];\n      }\n\n      return val;\n    }\n  }\n\n  return parse(expression, options);\n};\n/**\n * Convert cron fields back to Cron Expression\n *\n * @public\n * @param {Object} fields Input fields\n * @param {Object} [options] Parsing options\n * @return {Object}\n */\n\n\nCronExpression.fieldsToExpression = function fieldsToExpression(fields, options) {\n  function validateConstraints(field, values, constraints) {\n    if (!values) {\n      throw new Error('Validation error, Field ' + field + ' is missing');\n    }\n\n    if (values.length === 0) {\n      throw new Error('Validation error, Field ' + field + ' contains no values');\n    }\n\n    for (var i = 0, c = values.length; i < c; i++) {\n      var value = values[i];\n\n      if (typeof value === 'string' && constraints.chars.indexOf(value) > -1) {\n        continue;\n      } // Check constraints\n\n\n      if (typeof value !== 'number' || safeIsNaN(value) || value < constraints.min || value > constraints.max) {\n        throw new Error('Constraint error, got value ' + value + ' expected range ' + constraints.min + '-' + constraints.max);\n      }\n    }\n  }\n\n  var mappedFields = {};\n\n  for (var i = 0, c = CronExpression.map.length; i < c; ++i) {\n    var field = CronExpression.map[i]; // Field name\n\n    var values = fields[field];\n    validateConstraints(field, values, CronExpression.constraints[i]);\n    var copy = [];\n    var j = -1;\n\n    while (++j < values.length) {\n      copy[j] = values[j];\n    }\n\n    values = copy.sort(CronExpression._sortCompareFn).filter(function (item, pos, ary) {\n      return !pos || item !== ary[pos - 1];\n    });\n\n    if (values.length !== copy.length) {\n      throw new Error('Validation error, Field ' + field + ' contains duplicate values');\n    }\n\n    mappedFields[field] = values;\n  }\n\n  var dayOfMonth = CronExpression._handleMaxDaysInMonth(mappedFields);\n\n  mappedFields.dayOfMonth = dayOfMonth || mappedFields.dayOfMonth;\n  return new CronExpression(mappedFields, options || {});\n};\n\nmodule.exports = CronExpression;","map":{"version":3,"names":["CronDate","require","safeIsNaN","stringifyField","LOOP_LIMIT","CronExpression","fields","options","_options","_utc","utc","_tz","tz","_currentDate","currentDate","_startDate","startDate","_endDate","endDate","_isIterator","iterator","_hasIterated","_nthDayOfWeek","nthDayOfWeek","_freezeFields","map","predefined","constraints","min","max","chars","daysInMonth","aliases","month","jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec","dayOfWeek","sun","mon","tue","wed","thu","fri","sat","parseDefaults","standardValidCharacters","dayOfWeekValidCharacters","dayOfMonthValidCharacters","validCharacters","second","minute","hour","dayOfMonth","_parseField","field","value","replace","match","toLowerCase","Error","test","indexOf","parseSequence","val","stack","handleResult","result","Array","i","c","length","push","numResult","atoms","split","every","atom","parseRepeat","sort","_sortCompareFn","repeatInterval","parseRange","repeatIndex","index","count","a","b","aIsNumber","bIsNumber","localeCompare","_handleMaxDaysInMonth","mappedFields","filter","Object","freeze","prototype","_applyTimezoneShift","dateMathVerb","method","prevTime","getTime","currTime","getMinutes","getSeconds","addHour","subtractHour","previousHour","getHours","currentHour","diff","_dstStart","_dstEnd","_findSchedule","reverse","matchSchedule","sequence","isNthDayMatch","date","getDate","offset","adjustedDate","occurrence","Math","floor","isLInDayOfMonth","startTimestamp","stepCount","dayOfMonthMatch","isLastDayOfMonth","dayOfWeekMatch","getDay","isDayOfMonthWildcardMatch","getMonth","isDayOfWeekWildcardMatch","getMilliseconds","setMilliseconds","next","schedule","done","hasNext","prev","hasPrev","current","hasIterated","err","iterate","steps","callback","dates","item","reset","newDate","stringify","includeSeconds","resultArr","constraint","join","parse","expression","self","undefined","trim","start","parseNthDay","key","nthValue","fieldsToExpression","validateConstraints","values","copy","j","pos","ary","module","exports"],"sources":["D:/Other Files/tktnew/eMandate/client/node_modules/cron-parser/lib/expression.js"],"sourcesContent":["'use strict';\n\n// Load Date class extensions\nvar CronDate = require('./date');\n\n// Get Number.isNaN or the polyfill\nvar safeIsNaN = require('is-nan');\n\nvar stringifyField = require('./field_stringify');\n\n/**\n * Cron iteration loop safety limit\n */\nvar LOOP_LIMIT = 10000;\n\n/**\n * Construct a new expression parser\n *\n * Options:\n *   currentDate: iterator start date\n *   endDate: iterator end date\n *\n * @constructor\n * @private\n * @param {Object} fields  Expression fields parsed values\n * @param {Object} options Parser options\n */\nfunction CronExpression (fields, options) {\n  this._options = options;\n  this._utc = options.utc || false;\n  this._tz = this._utc ? 'UTC' : options.tz;\n  this._currentDate = new CronDate(options.currentDate, this._tz);\n  this._startDate = options.startDate ? new CronDate(options.startDate, this._tz) : null;\n  this._endDate = options.endDate ? new CronDate(options.endDate, this._tz) : null;\n  this._isIterator = options.iterator || false;\n  this._hasIterated = false;\n  this._nthDayOfWeek = options.nthDayOfWeek || 0;\n  this.fields = CronExpression._freezeFields(fields);\n}\n\n/**\n * Field mappings\n * @type {Array}\n */\nCronExpression.map = [ 'second', 'minute', 'hour', 'dayOfMonth', 'month', 'dayOfWeek' ];\n\n/**\n * Prefined intervals\n * @type {Object}\n */\nCronExpression.predefined = {\n  '@yearly': '0 0 1 1 *',\n  '@monthly': '0 0 1 * *',\n  '@weekly': '0 0 * * 0',\n  '@daily': '0 0 * * *',\n  '@hourly': '0 * * * *'\n};\n\n/**\n * Fields constraints\n * @type {Array}\n */\nCronExpression.constraints = [\n  { min: 0, max: 59, chars: [] }, // Second\n  { min: 0, max: 59, chars: [] }, // Minute\n  { min: 0, max: 23, chars: [] }, // Hour\n  { min: 1, max: 31, chars: ['L'] }, // Day of month\n  { min: 1, max: 12, chars: [] }, // Month\n  { min: 0, max: 7, chars: [] }, // Day of week\n];\n\n/**\n * Days in month\n * @type {number[]}\n */\nCronExpression.daysInMonth = [\n  31,\n  29,\n  31,\n  30,\n  31,\n  30,\n  31,\n  31,\n  30,\n  31,\n  30,\n  31\n];\n\n/**\n * Field aliases\n * @type {Object}\n */\nCronExpression.aliases = {\n  month: {\n    jan: 1,\n    feb: 2,\n    mar: 3,\n    apr: 4,\n    may: 5,\n    jun: 6,\n    jul: 7,\n    aug: 8,\n    sep: 9,\n    oct: 10,\n    nov: 11,\n    dec: 12\n  },\n\n  dayOfWeek: {\n    sun: 0,\n    mon: 1,\n    tue: 2,\n    wed: 3,\n    thu: 4,\n    fri: 5,\n    sat: 6\n  }\n};\n\n/**\n * Field defaults\n * @type {Array}\n */\nCronExpression.parseDefaults = [ '0', '*', '*', '*', '*', '*' ];\n\nCronExpression.standardValidCharacters = /^[\\d|/|*|\\-|,]+$/;\nCronExpression.dayOfWeekValidCharacters = /^[\\d|/|*|\\-|,|\\?]+$/;\nCronExpression.dayOfMonthValidCharacters = /^[\\d|L|/|*|\\-|,|\\?]+$/;\nCronExpression.validCharacters = {\n  second: CronExpression.standardValidCharacters,\n  minute: CronExpression.standardValidCharacters,\n  hour: CronExpression.standardValidCharacters,\n  dayOfMonth: CronExpression.dayOfMonthValidCharacters,\n  month: CronExpression.standardValidCharacters,\n  dayOfWeek: CronExpression.dayOfWeekValidCharacters,\n};\n\n/**\n * Parse input interval\n *\n * @param {String} field Field symbolic name\n * @param {String} value Field value\n * @param {Array} constraints Range upper and lower constraints\n * @return {Array} Sequence of sorted values\n * @private\n */\nCronExpression._parseField = function _parseField (field, value, constraints) {\n  // Replace aliases\n  switch (field) {\n    case 'month':\n    case 'dayOfWeek':\n      var aliases = CronExpression.aliases[field];\n\n      value = value.replace(/[a-z]{1,3}/gi, function(match) {\n        match = match.toLowerCase();\n\n        if (typeof aliases[match] !== 'undefined') {\n          return aliases[match];\n        } else {\n          throw new Error('Validation error, cannot resolve alias \"' + match + '\"');\n        }\n      });\n      break;\n  }\n\n  // Check for valid characters.\n  if (!(CronExpression.validCharacters[field].test(value))) {\n    throw new Error('Invalid characters, got value: ' + value);\n  }\n\n  // Replace '*' and '?'\n  if (value.indexOf('*') !== -1) {\n    value = value.replace(/\\*/g, constraints.min + '-' + constraints.max);\n  } else if (value.indexOf('?') !== -1) {\n    value = value.replace(/\\?/g, constraints.min + '-' + constraints.max);\n  }\n\n  //\n  // Inline parsing functions\n  //\n  // Parser path:\n  //  - parseSequence\n  //    - parseRepeat\n  //      - parseRange\n\n  /**\n   * Parse sequence\n   *\n   * @param {String} val\n   * @return {Array}\n   * @private\n   */\n  function parseSequence (val) {\n    var stack = [];\n\n    function handleResult (result) {\n      if (result instanceof Array) { // Make sequence linear\n        for (var i = 0, c = result.length; i < c; i++) {\n          var value = result[i];\n\n          if (typeof value === 'string' && constraints.chars.indexOf(value) > -1) {\n            stack.push(value);\n            continue;\n          }\n          // Check constraints\n          if (typeof value !== 'number' || safeIsNaN(value) || value < constraints.min || value > constraints.max) {\n            throw new Error(\n                'Constraint error, got value ' + value + ' expected range ' +\n                constraints.min + '-' + constraints.max\n            );\n          }\n\n          stack.push(value);\n        }\n      } else { // Scalar value\n\n        if (typeof result === 'string' && constraints.chars.indexOf(result) > -1) {\n          stack.push(result);\n          return;\n        }\n\n        var numResult = +result;\n\n        // Check constraints\n        if (safeIsNaN(numResult) || numResult < constraints.min || numResult > constraints.max) {\n          throw new Error(\n            'Constraint error, got value ' + result + ' expected range ' +\n            constraints.min + '-' + constraints.max\n          );\n        }\n\n        if (field === 'dayOfWeek') {\n          numResult = numResult % 7;\n        }\n\n        stack.push(numResult);\n      }\n    }\n\n    var atoms = val.split(',');\n    if (!atoms.every(function (atom) {\n      return atom.length > 0;\n    })) {\n      throw new Error('Invalid list value format');\n    }\n\n    if (atoms.length > 1) {\n      for (var i = 0, c = atoms.length; i < c; i++) {\n        handleResult(parseRepeat(atoms[i]));\n      }\n    } else {\n      handleResult(parseRepeat(val));\n    }\n\n    stack.sort(CronExpression._sortCompareFn);\n\n    return stack;\n  }\n\n  /**\n   * Parse repetition interval\n   *\n   * @param {String} val\n   * @return {Array}\n   */\n  function parseRepeat (val) {\n    var repeatInterval = 1;\n    var atoms = val.split('/');\n\n    if (atoms.length > 1) {\n      if (atoms[0] == +atoms[0]) {\n        atoms = [atoms[0] + '-' + constraints.max, atoms[1]];\n      }\n      return parseRange(atoms[0], atoms[atoms.length - 1]);\n    }\n\n    return parseRange(val, repeatInterval);\n  }\n\n  /**\n   * Parse range\n   *\n   * @param {String} val\n   * @param {Number} repeatInterval Repetition interval\n   * @return {Array}\n   * @private\n   */\n  function parseRange (val, repeatInterval) {\n    var stack = [];\n    var atoms = val.split('-');\n\n    if (atoms.length > 1 ) {\n      // Invalid range, return value\n      if (atoms.length < 2) {\n        return +val;\n      }\n\n      if (!atoms[0].length) {\n        if (!atoms[1].length) {\n          throw new Error('Invalid range: ' + val);\n        }\n\n        return +val;\n      }\n\n      // Validate range\n      var min = +atoms[0];\n      var max = +atoms[1];\n\n      if (safeIsNaN(min) || safeIsNaN(max) ||\n          min < constraints.min || max > constraints.max) {\n        throw new Error(\n          'Constraint error, got range ' +\n          min + '-' + max +\n          ' expected range ' +\n          constraints.min + '-' + constraints.max\n        );\n      } else if (min >= max) {\n        throw new Error('Invalid range: ' + val);\n      }\n\n      // Create range\n      var repeatIndex = +repeatInterval;\n\n      if (safeIsNaN(repeatIndex) || repeatIndex <= 0) {\n        throw new Error('Constraint error, cannot repeat at every ' + repeatIndex + ' time.');\n      }\n\n      for (var index = min, count = max; index <= count; index++) {\n        if (repeatIndex > 0 && (repeatIndex % repeatInterval) === 0) {\n          repeatIndex = 1;\n          stack.push(index);\n        } else {\n          repeatIndex++;\n        }\n      }\n\n      return stack;\n    }\n\n    return safeIsNaN(+val) ? val : +val;\n  }\n\n  return parseSequence(value);\n};\n\nCronExpression._sortCompareFn = function(a, b) {\n  var aIsNumber = typeof a === 'number';\n  var bIsNumber = typeof b === 'number';\n\n  if (aIsNumber && bIsNumber) {\n    return a - b;\n  }\n\n  if (!aIsNumber && bIsNumber) {\n    return 1;\n  }\n\n  if (aIsNumber && !bIsNumber) {\n    return -1;\n  }\n\n  return a.localeCompare(b);\n};\n\nCronExpression._handleMaxDaysInMonth = function(mappedFields) {\n  // Filter out any day of month value that is larger than given month expects\n  if (mappedFields.month.length === 1) {\n    var daysInMonth = CronExpression.daysInMonth[mappedFields.month[0] - 1];\n\n    if (mappedFields.dayOfMonth[0] > daysInMonth) {\n      throw new Error('Invalid explicit day of month definition');\n    }\n\n    return mappedFields.dayOfMonth\n      .filter(function(dayOfMonth) {\n        return dayOfMonth === 'L' ? true : dayOfMonth <= daysInMonth;\n      })\n      .sort(CronExpression._sortCompareFn);\n  }\n};\n\nCronExpression._freezeFields = function(fields) {\n  for (var i = 0, c = CronExpression.map.length; i < c; ++i) {\n    var field = CronExpression.map[i]; // Field name\n    var value = fields[field];\n    fields[field] = Object.freeze(value);\n  }\n  return Object.freeze(fields);\n};\n\nCronExpression.prototype._applyTimezoneShift = function(currentDate, dateMathVerb, method) {\n  if ((method === 'Month') || (method === 'Day')) {\n    var prevTime = currentDate.getTime();\n    currentDate[dateMathVerb + method]();\n    var currTime = currentDate.getTime();\n    if (prevTime === currTime) {\n      // Jumped into a not existent date due to a DST transition\n      if ((currentDate.getMinutes() === 0) &&\n          (currentDate.getSeconds() === 0)) {\n        currentDate.addHour();\n      } else if ((currentDate.getMinutes() === 59) &&\n                 (currentDate.getSeconds() === 59)) {\n        currentDate.subtractHour();\n      }\n    }\n  } else {\n    var previousHour = currentDate.getHours();\n    currentDate[dateMathVerb + method]();\n    var currentHour = currentDate.getHours();\n    var diff = currentHour - previousHour;\n    if (diff === 2) {\n        // Starting DST\n        if (this.fields.hour.length !== 24) {\n          // Hour is specified\n          this._dstStart = currentHour;\n        }\n      } else if ((diff === 0) &&\n                 (currentDate.getMinutes() === 0) &&\n                 (currentDate.getSeconds() === 0)) {\n        // Ending DST\n        if (this.fields.hour.length !== 24) {\n          // Hour is specified\n          this._dstEnd = currentHour;\n        }\n      }\n  }\n};\n\n\n/**\n * Find next or previous matching schedule date\n *\n * @return {CronDate}\n * @private\n */\nCronExpression.prototype._findSchedule = function _findSchedule (reverse) {\n\n  /**\n   * Match field value\n   *\n   * @param {String} value\n   * @param {Array} sequence\n   * @return {Boolean}\n   * @private\n   */\n  function matchSchedule (value, sequence) {\n    for (var i = 0, c = sequence.length; i < c; i++) {\n      if (sequence[i] >= value) {\n        return sequence[i] === value;\n      }\n    }\n\n    return sequence[0] === value;\n  }\n\n  /**\n   * Helps determine if the provided date is the correct nth occurence of the\n   * desired day of week.\n   *\n   * @param {CronDate} date\n   * @param {Number} nthDayOfWeek\n   * @return {Boolean}\n   * @private\n   */\n  function isNthDayMatch(date, nthDayOfWeek) {\n    if (nthDayOfWeek < 6) {\n      if (\n        date.getDate() < 8 &&\n        nthDayOfWeek === 1 // First occurence has to happen in first 7 days of the month\n      ) {\n        return true;\n      }\n\n      var offset = date.getDate() % 7 ? 1 : 0; // Math is off by 1 when dayOfWeek isn't divisible by 7\n      var adjustedDate = date.getDate() - (date.getDate() % 7); // find the first occurance\n      var occurrence = Math.floor(adjustedDate / 7) + offset;\n\n      return occurrence === nthDayOfWeek;\n    }\n\n    return false;\n  }\n\n  /**\n   * Helper function that checks if 'L' is in the array\n   *\n   * @param {Array} dayOfMonth\n   */\n  function isLInDayOfMonth(dayOfMonth) {\n    return dayOfMonth.length > 0 && dayOfMonth.indexOf('L') >= 0;\n  }\n\n  // Whether to use backwards directionality when searching\n  reverse = reverse || false;\n  var dateMathVerb = reverse ? 'subtract' : 'add';\n\n  var currentDate = new CronDate(this._currentDate, this._tz);\n  var startDate = this._startDate;\n  var endDate = this._endDate;\n\n  // Find matching schedule\n  var startTimestamp = currentDate.getTime();\n  var stepCount = 0;\n\n  while (stepCount < LOOP_LIMIT) {\n    stepCount++;\n\n    // Validate timespan\n    if (reverse) {\n      if (startDate && (currentDate.getTime() - startDate.getTime() < 0)) {\n        throw new Error('Out of the timespan range');\n      }\n    } else {\n      if (endDate && (endDate.getTime() - currentDate.getTime()) < 0) {\n        throw new Error('Out of the timespan range');\n      }\n    }\n\n    // Day of month and week matching:\n    //\n    // \"The day of a command's execution can be specified by two fields --\n    // day of month, and day of week.  If  both\t fields\t are  restricted  (ie,\n    // aren't  *),  the command will be run when either field matches the cur-\n    // rent time.  For example, \"30 4 1,15 * 5\" would cause a command to be\n    // run at 4:30 am on the  1st and 15th of each month, plus every Friday.\"\n    //\n    // http://unixhelp.ed.ac.uk/CGI/man-cgi?crontab+5\n    //\n\n    var dayOfMonthMatch = matchSchedule(currentDate.getDate(), this.fields.dayOfMonth);\n    if (isLInDayOfMonth(this.fields.dayOfMonth)) {\n      dayOfMonthMatch = dayOfMonthMatch || currentDate.isLastDayOfMonth();\n    }\n    var dayOfWeekMatch = matchSchedule(currentDate.getDay(), this.fields.dayOfWeek);\n    var isDayOfMonthWildcardMatch = this.fields.dayOfMonth.length >= CronExpression.daysInMonth[currentDate.getMonth()];\n    var isDayOfWeekWildcardMatch = this.fields.dayOfWeek.length === CronExpression.constraints[5].max - CronExpression.constraints[5].min + 1;\n    var currentHour = currentDate.getHours();\n\n    // Add or subtract day if select day not match with month (according to calendar)\n    if (!dayOfMonthMatch && !dayOfWeekMatch) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n      continue;\n    }\n\n    // Add or subtract day if not day of month is set (and no match) and day of week is wildcard\n    if (!isDayOfMonthWildcardMatch && isDayOfWeekWildcardMatch && !dayOfMonthMatch) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n      continue;\n    }\n\n    // Add or subtract day if not day of week is set (and no match) and day of month is wildcard\n    if (isDayOfMonthWildcardMatch && !isDayOfWeekWildcardMatch && !dayOfWeekMatch) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n      continue;\n    }\n\n    // Add or subtract day if day of week & nthDayOfWeek are set (and no match)\n    if (\n      this._nthDayOfWeek > 0 &&\n      !isNthDayMatch(currentDate, this._nthDayOfWeek)\n    ) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Day');\n      continue;\n    }\n\n    // Match month\n    if (!matchSchedule(currentDate.getMonth() + 1, this.fields.month)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Month');\n      continue;\n    }\n\n    // Match hour\n    if (!matchSchedule(currentHour, this.fields.hour)) {\n      if (this._dstStart !== currentHour) {\n        this._dstStart = null;\n        this._applyTimezoneShift(currentDate, dateMathVerb, 'Hour');\n        continue;\n      } else if (!matchSchedule(currentHour - 1, this.fields.hour)) {\n        currentDate[dateMathVerb + 'Hour']();\n        continue;\n      }\n    } else if (this._dstEnd === currentHour) {\n      if (!reverse) {\n        this._dstEnd = null;\n        this._applyTimezoneShift(currentDate, 'add', 'Hour');\n        continue;\n      }\n    }\n\n    // Match minute\n    if (!matchSchedule(currentDate.getMinutes(), this.fields.minute)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Minute');\n      continue;\n    }\n\n    // Match second\n    if (!matchSchedule(currentDate.getSeconds(), this.fields.second)) {\n      this._applyTimezoneShift(currentDate, dateMathVerb, 'Second');\n      continue;\n    }\n\n    // Increase a second in case in the first iteration the currentDate was not\n    // modified\n    if (startTimestamp === currentDate.getTime()) {\n      if ((dateMathVerb === 'add') || (currentDate.getMilliseconds() === 0)) {\n        this._applyTimezoneShift(currentDate, dateMathVerb, 'Second');\n      } else {\n        currentDate.setMilliseconds(0);\n      }\n\n      continue;\n    }\n\n    break;\n  }\n\n  if (stepCount >= LOOP_LIMIT) {\n    throw new Error('Invalid expression, loop limit exceeded');\n  }\n\n  this._currentDate = new CronDate(currentDate, this._tz);\n  this._hasIterated = true;\n\n  return currentDate;\n};\n\n/**\n * Find next suitable date\n *\n * @public\n * @return {CronDate|Object}\n */\nCronExpression.prototype.next = function next () {\n  var schedule = this._findSchedule();\n\n  // Try to return ES6 compatible iterator\n  if (this._isIterator) {\n    return {\n      value: schedule,\n      done: !this.hasNext()\n    };\n  }\n\n  return schedule;\n};\n\n/**\n * Find previous suitable date\n *\n * @public\n * @return {CronDate|Object}\n */\nCronExpression.prototype.prev = function prev () {\n  var schedule = this._findSchedule(true);\n\n  // Try to return ES6 compatible iterator\n  if (this._isIterator) {\n    return {\n      value: schedule,\n      done: !this.hasPrev()\n    };\n  }\n\n  return schedule;\n};\n\n/**\n * Check if next suitable date exists\n *\n * @public\n * @return {Boolean}\n */\nCronExpression.prototype.hasNext = function() {\n  var current = this._currentDate;\n  var hasIterated = this._hasIterated;\n\n  try {\n    this._findSchedule();\n    return true;\n  } catch (err) {\n    return false;\n  } finally {\n    this._currentDate = current;\n    this._hasIterated = hasIterated;\n  }\n};\n\n/**\n * Check if previous suitable date exists\n *\n * @public\n * @return {Boolean}\n */\nCronExpression.prototype.hasPrev = function() {\n  var current = this._currentDate;\n  var hasIterated = this._hasIterated;\n\n  try {\n    this._findSchedule(true);\n    return true;\n  } catch (err) {\n    return false;\n  } finally {\n    this._currentDate = current;\n    this._hasIterated = hasIterated;\n  }\n};\n\n/**\n * Iterate over expression iterator\n *\n * @public\n * @param {Number} steps Numbers of steps to iterate\n * @param {Function} callback Optional callback\n * @return {Array} Array of the iterated results\n */\nCronExpression.prototype.iterate = function iterate (steps, callback) {\n  var dates = [];\n\n  if (steps >= 0) {\n    for (var i = 0, c = steps; i < c; i++) {\n      try {\n        var item = this.next();\n        dates.push(item);\n\n        // Fire the callback\n        if (callback) {\n          callback(item, i);\n        }\n      } catch (err) {\n        break;\n      }\n    }\n  } else {\n    for (var i = 0, c = steps; i > c; i--) {\n      try {\n        var item = this.prev();\n        dates.push(item);\n\n        // Fire the callback\n        if (callback) {\n          callback(item, i);\n        }\n      } catch (err) {\n        break;\n      }\n    }\n  }\n\n  return dates;\n};\n\n/**\n * Reset expression iterator state\n *\n * @public\n */\nCronExpression.prototype.reset = function reset (newDate) {\n  this._currentDate = new CronDate(newDate || this._options.currentDate);\n};\n\n/**\n * Stringify the expression\n *\n * @public\n * @param {Boolean} [includeSeconds] Should stringify seconds\n * @return {String}\n */\nCronExpression.prototype.stringify = function stringify(includeSeconds) {\n  var resultArr = [];\n  for (var i = includeSeconds ? 0 : 1, c = CronExpression.map.length; i < c; ++i) {\n    var field = CronExpression.map[i];\n    var value = this.fields[field];\n    var constraint = CronExpression.constraints[i];\n    resultArr.push(stringifyField(value, constraint.min, constraint.max));\n  }\n  return resultArr.join(' ');\n};\n\n/**\n * Parse input expression (async)\n *\n * @public\n * @param {String} expression Input expression\n * @param {Object} [options] Parsing options\n */\nCronExpression.parse = function parse(expression, options) {\n  var self = this;\n  if (typeof options === 'function') {\n    options = {};\n  }\n\n  function parse (expression, options) {\n    if (!options) {\n      options = {};\n    }\n\n    if (typeof options.currentDate === 'undefined') {\n      options.currentDate = new CronDate(undefined, self._tz);\n    }\n\n    // Is input expression predefined?\n    if (CronExpression.predefined[expression]) {\n      expression = CronExpression.predefined[expression];\n    }\n\n    // Split fields\n    var fields = [];\n    var atoms = (expression + '').trim().split(/\\s+/);\n\n    if (atoms.length > 6) {\n      throw new Error('Invalid cron expression');\n    }\n\n    // Resolve fields\n    var start = (CronExpression.map.length - atoms.length);\n    for (var i = 0, c = CronExpression.map.length; i < c; ++i) {\n      var field = CronExpression.map[i]; // Field name\n      var value = atoms[atoms.length > c ? i : i - start]; // Field value\n\n      if (i < start || !value) { // Use default value\n        fields.push(CronExpression._parseField(\n          field,\n          CronExpression.parseDefaults[i],\n          CronExpression.constraints[i]\n          )\n        );\n      } else {\n        var val = field === 'dayOfWeek' ? parseNthDay(value) : value;\n\n        fields.push(CronExpression._parseField(\n          field,\n          val,\n          CronExpression.constraints[i]\n          )\n        );\n      }\n    }\n\n    var mappedFields = {};\n    for (var i = 0, c = CronExpression.map.length; i < c; i++) {\n      var key = CronExpression.map[i];\n      mappedFields[key] = fields[i];\n    }\n\n    var dayOfMonth = CronExpression._handleMaxDaysInMonth(mappedFields);\n    mappedFields.dayOfMonth = dayOfMonth || mappedFields.dayOfMonth;\n    return new CronExpression(mappedFields, options);\n\n    /**\n     * Parses out the # special character for the dayOfWeek field & adds it to options.\n     *\n     * @param {String} val\n     * @return {String}\n     * @private\n     */\n    function parseNthDay(val) {\n      var atoms = val.split('#');\n      if (atoms.length > 1) {\n        var nthValue = +atoms[atoms.length - 1];\n        if(/,/.test(val)) {\n          throw new Error('Constraint error, invalid dayOfWeek `#` and `,` '\n            + 'special characters are incompatible');\n        }\n        if(/\\//.test(val)) {\n          throw new Error('Constraint error, invalid dayOfWeek `#` and `/` '\n            + 'special characters are incompatible');\n        }\n        if(/-/.test(val)) {\n          throw new Error('Constraint error, invalid dayOfWeek `#` and `-` '\n            + 'special characters are incompatible');\n        }\n        if (atoms.length > 2 || safeIsNaN(nthValue) || (nthValue < 1 || nthValue > 5)) {\n          throw new Error('Constraint error, invalid dayOfWeek occurrence number (#)');\n        }\n\n        options.nthDayOfWeek = nthValue;\n        return atoms[0];\n      }\n      return val;\n    }\n  }\n\n  return parse(expression, options);\n};\n\n/**\n * Convert cron fields back to Cron Expression\n *\n * @public\n * @param {Object} fields Input fields\n * @param {Object} [options] Parsing options\n * @return {Object}\n */\nCronExpression.fieldsToExpression = function fieldsToExpression(fields, options) {\n  function validateConstraints (field, values, constraints) {\n    if (!values) {\n      throw new Error('Validation error, Field ' + field + ' is missing');\n    }\n    if (values.length === 0) {\n      throw new Error('Validation error, Field ' + field + ' contains no values');\n    }\n    for (var i = 0, c = values.length; i < c; i++) {\n      var value = values[i];\n\n      if (typeof value === 'string' && constraints.chars.indexOf(value) > -1) {\n        continue;\n      }\n      // Check constraints\n      if (typeof value !== 'number' || safeIsNaN(value) || value < constraints.min || value > constraints.max) {\n        throw new Error(\n          'Constraint error, got value ' + value + ' expected range ' +\n          constraints.min + '-' + constraints.max\n        );\n      }\n    }\n  }\n\n  var mappedFields = {};\n  for (var i = 0, c = CronExpression.map.length; i < c; ++i) {\n    var field = CronExpression.map[i]; // Field name\n    var values = fields[field];\n    validateConstraints(\n      field,\n      values,\n      CronExpression.constraints[i]\n    );\n    var copy = [];\n    var j = -1;\n    while (++j < values.length) {\n      copy[j] = values[j];\n    }\n    values = copy.sort(CronExpression._sortCompareFn)\n      .filter(function(item, pos, ary) {\n        return !pos || item !== ary[pos - 1];\n      });\n    if (values.length !== copy.length) {\n      throw new Error('Validation error, Field ' + field + ' contains duplicate values');\n    }\n    mappedFields[field] = values;\n  }\n  var dayOfMonth = CronExpression._handleMaxDaysInMonth(mappedFields);\n  mappedFields.dayOfMonth = dayOfMonth || mappedFields.dayOfMonth;\n  return new CronExpression(mappedFields, options || {});\n};\n\nmodule.exports = CronExpression;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}